<?xml version="1.0" encoding="UTF-8"?>
 
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    
    <changeSet author="anatoleabe (generated)" id="1620641683809-1">
        <createTable tableName="pharm_customer">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(10)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="address" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(100)"/>
            <column name="tel" type="VARCHAR(20)"/>
            <column name="patient_id" type="INT"/>
            <column name="customer_type_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-2">
        <createTable tableName="pharm_customer_type">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(20)"/>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-3">
        <createTable tableName="pharm_item">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(10)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="unit_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="route_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="sell_price" type="DOUBLE"/>
            <column name="AMC" type="DOUBLE"/>
            <column name="buy_price" type="DOUBLE">
                <constraints nullable="false"/>
            </column>
            <column name="virtualstock" type="INT"/>
            <column name="soh" type="INT"/>
            <column name="stock_min" type="INT"/>
            <column name="stock_max" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-4">
        <createTable tableName="pharm_items_line">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="item_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="location_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="item_batch" type="VARCHAR(50)"/>
            <column name="item_expiry_date" type="datetime"/>
            <column name="item_virtualstock" type="INT"/>
            <column name="item_soh" type="INT"/>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-5">
        <createTable tableName="pharm_order_detail">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="item_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="order_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="order_line_quantity" type="INT"/>
            <column name="item_soh" type="INT"/>
            <column name="item_amc" type="INT"/>
            <column name="order_line_amount" type="DOUBLE"/>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-7">
        <createTable tableName="pharm_pharmacy_location">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(10)"/>
            <column name="name" type="VARCHAR(100)"/>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-8">
        <createTable tableName="pharm_pharmacy_order">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="supplier_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="date" type="datetime"/>
            <column name="person_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="amount" type="DOUBLE"/>
            <column name="date_approbation" type="datetime"/>
            <column name="date_reception" type="datetime"/>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-9">
        <createTable tableName="pharm_reception">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="date" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="order_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="person_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-10">
        <createTable tableName="pharm_reception_detail">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="reception_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="item_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="order_line_quantity" type="INT"/>
            <column name="quantity_received" type="INT"/>
            <column name="item_batch" type="VARCHAR(50)"/>
            <column name="item_expiry_date" type="datetime"/>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-11">
        <createTable tableName="pharm_route">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="code" type="VARCHAR(10)"/>
            <column name="name" type="VARCHAR(50)"/>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-12">
        <createTable tableName="pharm_sending">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="date" type="datetime"/>
            <column name="customer_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="sending_amount" type="DOUBLE"/>
            <column name="person_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="customer_type_id" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-13">
        <createTable tableName="pharm_sending_detail">
            <column autoIncrement="true" name="id" type="INT">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="item_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="sending_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="item_line_id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="sending_details_quantity" type="INT"/>
            <column name="sending_details_value" type="DOUBLE"/>
            <column name="sending_item_batch" type="VARCHAR(50)"/>
            <column name="sending_item_expiry_date" type="datetime"/>
        </createTable>
    </changeSet>
    
    <changeSet author="anatoleabe (generated)" id="1620641683809-16">
        <createTable tableName="pharm_supplier">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(10)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="address" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(100)"/>
            <column name="tel" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-17">
        <createTable tableName="pharm_transaction">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="date" type="datetime"/>
            <column name="transaction_type" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="INT"/>
            <column name="item_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="item_batch" type="VARCHAR(50)"/>
            <column name="item_expiry_date" type="datetime"/>
            <column name="location_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="person_id" type="INT"/>
            <column name="amount" type="DOUBLE"/>
            <column name="status" type="VARCHAR(10)"/>
            <column name="sending_id" type="INT"/>
            <column name="reception_id" type="INT"/>
            <column name="adjustment_date" type="datetime"/>
            <column name="reason" type="VARCHAR(128)"/>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-19">
        <createTable tableName="pharm_unit">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(10)"/>
            <column name="name" type="VARCHAR(50)"/>
        </createTable>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-20">
        <createIndex indexName="FKpharm_cust449636" tableName="pharm_customer">
            <column name="customer_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-20-1">
        <createIndex indexName="FKpharm_send349636" tableName="pharm_sending">
            <column name="customer_type_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-21">
        <createIndex indexName="FKpharm_item577093" tableName="pharm_item">
            <column name="unit_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-22">
        <createIndex indexName="FKpharm_item581647" tableName="pharm_item">
            <column name="route_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-23">
        <createIndex indexName="FKpharm_item774750" tableName="pharm_items_line">
            <column name="location_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-24">
        <createIndex indexName="FKpharm_orde784692" tableName="pharm_order_detail">
            <column name="order_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-25">
        <createIndex indexName="FKpharm_orde820648" tableName="pharm_pharmacy_order">
            <column name="person_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-26">
        <createIndex indexName="FKpharm_orde883098" tableName="pharm_pharmacy_order">
            <column name="supplier_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-28">
        <createIndex indexName="FKpharm_rece377506" tableName="pharm_reception">
            <column name="person_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-29">
        <createIndex indexName="FKpharm_rece738543" tableName="pharm_reception">
            <column name="order_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-30">
        <createIndex indexName="FKpharm_send193203" tableName="pharm_sending">
            <column name="person_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-31">
        <createIndex indexName="FKpharm_send269367" tableName="pharm_sending">
            <column name="customer_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-32">
        <createIndex indexName="FKpharm_send286846" tableName="pharm_sending_detail">
            <column name="sending_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-36">
        <createIndex indexName="FKpharm_tran828906" tableName="pharm_transaction">
            <column name="location_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-37">
        <createIndex indexName="FKpharm_tran892810" tableName="pharm_transaction">
            <column name="item_id"/>
        </createIndex>
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-38">
        <addForeignKeyConstraint baseColumnNames="customer_type_id" baseTableName="pharm_customer" constraintName="FKpharm_cust449636" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_customer_type" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-38-1">
        <addForeignKeyConstraint baseColumnNames="customer_type_id" baseTableName="pharm_sending" constraintName="FKpharm_send349636" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_customer_type" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-39">
        <addForeignKeyConstraint baseColumnNames="unit_id" baseTableName="pharm_item" constraintName="FKpharm_item577093" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_unit" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-40">
        <addForeignKeyConstraint baseColumnNames="route_id" baseTableName="pharm_item" constraintName="FKpharm_item581647" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_route" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-41">
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="pharm_items_line" constraintName="FKpharm_item710846" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_item" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-42">
        <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="pharm_items_line" constraintName="FKpharm_item774750" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_pharmacy_location" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-43">
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="pharm_order_detail" constraintName="FKpharm_orde637966" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_item" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-44">
        <addForeignKeyConstraint baseColumnNames="order_id" baseTableName="pharm_order_detail" constraintName="FKpharm_orde784692" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_pharmacy_order" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-45">
        <addForeignKeyConstraint baseColumnNames="person_id" baseTableName="pharm_pharmacy_order" constraintName="FKpharm_orde820648" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="person_id" referencedTableName="person" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-46">
        <addForeignKeyConstraint baseColumnNames="supplier_id" baseTableName="pharm_pharmacy_order" constraintName="FKpharm_orde883098" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_supplier" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-47">
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="pharm_reception_detail" constraintName="FKpharm_rece13494" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_item" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-48">
        <addForeignKeyConstraint baseColumnNames="person_id" baseTableName="pharm_reception" constraintName="FKpharm_rece377506" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="person_id" referencedTableName="person" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-49">
        <addForeignKeyConstraint baseColumnNames="order_id" baseTableName="pharm_reception" constraintName="FKpharm_rece738543" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_pharmacy_order" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-50">
        <addForeignKeyConstraint baseColumnNames="reception_id" baseTableName="pharm_reception_detail" constraintName="FKpharm_rece853587" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_reception" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-51">
        <addForeignKeyConstraint baseColumnNames="person_id" baseTableName="pharm_sending" constraintName="FKpharm_send193203" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="person_id" referencedTableName="person" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-52">
        <addForeignKeyConstraint baseColumnNames="customer_id" baseTableName="pharm_sending" constraintName="FKpharm_send269367" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_customer" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-53">
        <addForeignKeyConstraint baseColumnNames="sending_id" baseTableName="pharm_sending_detail" constraintName="FKpharm_send286846" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_sending" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-54">
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="pharm_sending_detail" constraintName="FKpharm_send540246" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_item" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-59">
        <addForeignKeyConstraint baseColumnNames="location_id" baseTableName="pharm_transaction" constraintName="FKpharm_tran828906" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_pharmacy_location" />
    </changeSet>
    <changeSet author="anatoleabe (generated)" id="1620641683809-60">
        <addForeignKeyConstraint baseColumnNames="item_id" baseTableName="pharm_transaction" constraintName="FKpharm_tran892810" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_item" />
    </changeSet>
      
    <changeSet author="agilbert" id="1620641683809-61">
        <sql>
            ALTER TABLE pharm_supplier ADD CONSTRAINT UNIQUE (code)
        </sql>
    </changeSet>
    
    <changeSet author="agilbert" id="11620641683809-62">
        <sql>
            ALTER TABLE pharm_customer ADD CONSTRAINT UNIQUE(code)
        </sql>
    </changeSet>
    
    <changeSet author="agilbert" id="1620641683809-63">
        <sql>
            ALTER TABLE pharm_pharmacy_location ADD CONSTRAINT UNIQUE (code)
        </sql>
    </changeSet>
    
    
    <changeSet author="agilbert" id="1620641683809-64">
        <sql>
            ALTER TABLE pharm_item ADD CONSTRAINT  UNIQUE(code)
        </sql>
    </changeSet>

    <changeSet author="agilbert" id="1620641683809-65">
        <sql>
            ALTER TABLE pharm_unit ADD CONSTRAINT  UNIQUE (code)
        </sql>
    </changeSet>
    
    
    <changeSet author="agilbert" id="1620641683809-66">
        <sql>
            ALTER TABLE pharm_route ADD CONSTRAINT  UNIQUE (code)
        </sql>
    </changeSet>
    <changeSet  author="enokby"  id="enokby-1">  
        <dropNotNullConstraint  columnDataType="int" columnName="order_id" tableName="pharm_reception"/>  
    </changeSet>
    <changeSet  author="enokby"  id="enokby-2">  
        <dropNotNullConstraint  columnDataType="int" columnName="customer_id" tableName="pharm_sending"/>  
    </changeSet>
    <changeSet  author="enokby"  id="enokby-3">  
        <dropNotNullConstraint  columnDataType="int" columnName="person_id" tableName="pharm_sending"/>  
    </changeSet>
    <changeSet author="enokby" id="enokby-5"> 
        <addColumn tableName="pharm_sending" >
            <column  name="validation_date" type="date"/> 
        </addColumn>  
    </changeSet>
    
    <changeSet id="2720641683809-1" author="anatoleabe">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pharm_customer_type;
            </sqlCheck>
        </preConditions>
        <insert tableName="pharm_customer_type">
            <column name="name" value="Patient"/>
            <column name="uuid" value="b54a1ddd-d25b-492e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_customer_type">
            <column name="name" value="Service interne"/>
            <column name="uuid" value="37688e92-f19c-4f19-b369-cdd31c8e7fba"/>
        </insert>
        <insert tableName="pharm_customer_type">
            <column name="name" value="Service externe"/>
            <column name="uuid" value="a6284bc5-f3b0-4687-abce-16ff8423470b"/>
        </insert>
    </changeSet>
    
    <changeSet id="2720641683809-2" author="anatoleabe">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pharm_route;
            </sqlCheck>
        </preConditions>
        <insert tableName="pharm_route">
            <column name="code" value="VO"/>
            <column name="name" value="Voie orale"/>
            <column name="uuid" value="b54a3ddd-d25b-492e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VPI"/>
            <column name="name" value="Voie parentérale intraveineuse"/>
            <column name="uuid" value="b54a4ddd-d25b-492e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VPaI"/>
            <column name="name" value="Voie parentéral intramusculaire"/>
            <column name="uuid" value="b54a4ddd-d25b-492e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VPsc"/>
            <column name="name" value="Voie parentérale sous-cutanée"/>
            <column name="uuid" value="b54a5ddd-d25b-493e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VPaId"/>
            <column name="name" value="Voie parentérale intradermique"/>
            <column name="uuid" value="b54a5ddd-d25b-493e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VR"/>
            <column name="name" value="Voie rectale"/>
            <column name="uuid" value="b54a6ddd-d35b-493e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VV"/>
            <column name="name" value="voie vaginale"/>
            <column name="uuid" value="b54a9ddd-d35b-493e-98e8-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VOph"/>
            <column name="name" value="Voie ohptalmique"/>
            <column name="uuid" value="b64a9ddd-d35b-493e-98e8-5f1de0520e3a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VOnba"/>
            <column name="name" value="Voie ORL (nasale, buccopharyngée, auriculaire)"/>
            <column name="uuid" value="b31a9ddd-d35b-493e-98e8-5f1de0520e2a"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VResp"/>
            <column name="name" value="Voie respiratoire"/>
            <column name="uuid" value="b91a0ddd-d35b-493e-98e8-5f1de0520e2b"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VC"/>
            <column name="name" value="Voie cutanée"/>
            <column name="uuid" value="b93a0ddd-d35b-493e-98e8-4f1de0620e2b"/>
        </insert>
        <insert tableName="pharm_route">
            <column name="code" value="VTran"/>
            <column name="name" value="Voie transdermique"/>
            <column name="uuid" value="b31a0ddd-d35b-493e-98e9-6f1de0520e2b"/>
        </insert>
    </changeSet>
    
    <changeSet id="2720641683809-3" author="anatoleabe">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pharm_unit;
            </sqlCheck>
        </preConditions>
        <insert tableName="pharm_unit">
            <column name="code" value="001"/>
            <column name="name" value="Comprimé"/>
            <column name="uuid" value="b54a3ddd-dà1b-492e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="002"/>
            <column name="name" value="Gélule"/>
            <column name="uuid" value="b54a4ddd-d02b-492e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="003"/>
            <column name="name" value="Capsule"/>
            <column name="uuid" value="b54a4ddd-d03b-492e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="004"/>
            <column name="name" value="Granule"/>
            <column name="uuid" value="b54a5ddd-d04b-493e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="005"/>
            <column name="name" value="Solution buvable"/>
            <column name="uuid" value="b54a5ddd-d05b-493e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="006"/>
            <column name="name" value="Suspension buvable"/>
            <column name="uuid" value="b54a6ddd-d06b-493e-98e9-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="007"/>
            <column name="name" value="Solution nasale"/>
            <column name="uuid" value="b54a9ddd-d07b-493e-98e8-5f1de0520e1a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="008"/>
            <column name="name" value="Solution auriculaire"/>
            <column name="uuid" value="b64a9ddd-d08b-493e-98e8-5f1de0520e3a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="009"/>
            <column name="name" value="Solution ophtalmologique"/>
            <column name="uuid" value="b31a9ddd-d09b-493e-98e8-5f1de0520e2a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="010"/>
            <column name="name" value="Solution en ampoule"/>
            <column name="uuid" value="b91a0ddd-d10b-493e-98e8-5f1de0520e2b"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="011"/>
            <column name="name" value="Patch transdermique"/>
            <column name="uuid" value="b93a0ddd-d11b-493e-98e8-4f1de0620e2b"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="012"/>
            <column name="name" value="Pommade"/>
            <column name="uuid" value="b31a0ddd-d12b-493e-98e9-6f1de0520e2b"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="013"/>
            <column name="name" value="Crème"/>
            <column name="uuid" value="b64a9ddd-d13b-493e-98e8-5f1de0520e3a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="014"/>
            <column name="name" value="Gel"/>
            <column name="uuid" value="b31a9ddd-d14b-493e-98e8-5f1de0520e2a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="015"/>
            <column name="name" value="Poudre (lyophilisat)"/>
            <column name="uuid" value="b91a0ddd-d15b-493e-98e8-5f1de0520e2b"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="016"/>
            <column name="name" value="Solution pour perfusion lente"/>
            <column name="uuid" value="b93a0ddd-d16b-493e-98e8-4f1de0620e2b"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="017"/>
            <column name="name" value="Aérosol"/>
            <column name="uuid" value="b31a0ddd-d17b-493e-98e9-6f1de0520e2b"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="018"/>
            <column name="name" value="Suppositoire"/>
            <column name="uuid" value="b64a9ddd-d18b-493e-98e8-5f1de0520e3a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="019"/>
            <column name="name" value="Lavement"/>
            <column name="uuid" value="b31a9ddd-d19b-493e-98e8-5f1de0520e2a"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="020"/>
            <column name="name" value="Huile"/>
            <column name="uuid" value="b91a0ddd-d20b-493e-98e8-5f1de0520e2b"/>
        </insert>
        <insert tableName="pharm_unit">
            <column name="code" value="021"/>
            <column name="name" value="Préparation"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4f1de0620e2b"/>
        </insert>
        
    </changeSet>
    
    <changeSet id="pharm-202113171413" author="anatoleabe">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege like '%pharmacy:add or edit drugs%';</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:add or edit drugs"/>
            <column name="description" value="Savics pharmacy: Able to add or edit drugs"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4d1de0622a3b"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:delete a drug"/>
            <column name="description" value="Savics pharmacy: Able to delete a drug"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4g1de0620e2c"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:manage pharmacy settings"/>
            <column name="description" value="Savics pharmacy: Able to manage pharmacy settings"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4f1de0720e2g"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:register a drug order"/>
            <column name="description" value="Savics pharmacy: Able to register a drug order"/>
            <column name="uuid" value="f93a0ddd-d21b-493e-98e8-4f1de0620e4b"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:validate drug order"/>
            <column name="description" value="Savics pharmacy: Able to validate drug order"/>
            <column name="uuid" value="q93a0ddd-d21b-493e-98e8-4f1de0620e2v"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:register a receipt of drug"/>
            <column name="description" value="Savics pharmacy: Able to register a receipt of drug"/>
            <column name="uuid" value="b93a0ddd-d21b-483e-98e8-4f1de0620e2o"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:dispense drugs to patients"/>
            <column name="description" value="Savics pharmacy: Able to dispense drugs to patients"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4f1de0620f2i"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:validate drug dispensing"/>
            <column name="description" value="Savics pharmacy: Able to validate drug dispensing"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4f1de0620k2b"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:distribute drugs to departments"/>
            <column name="description" value="Savics pharmacy: Able to distribution of medications to departments"/>
            <column name="uuid" value="b93a0ddd-d21b-492e-98e8-4f1de0620o1b"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:validate the distribution of drugs to departments"/>
            <column name="description" value="Savics pharmacy: Able to validate the distribution of drugs to departments"/>
            <column name="uuid" value="b93a0qdd-d21b-491e-97e8-4f1de0620e2b"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:consult the stock of drugs"/>
            <column name="description" value="Savics pharmacy: Able to consult the stock of drugs"/>
            <column name="uuid" value="b93a0dud-d21b-493e-98e8-4f1de0620e2b"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:make adjustments"/>
            <column name="description" value="Savics pharmacy: Able to make adjustments"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-97e8-4f1de0620e8b"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:validate adjustments"/>
            <column name="description" value="Savics pharmacy: Able to validate adjustments"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-08e8-4f1de0620etb"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:entering inventories"/>
            <column name="description" value="Savics pharmacy: Able to entering inventories"/>
            <column name="uuid" value="b93a0ddd-d31b-493e-98e8-4f1de0620e8a"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:edit pharmacy reports"/>
            <column name="description" value="Savics pharmacy: Able to edit pharmacy reports"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4f1de0621e2c"/>
        </insert>
        <insert tableName="privilege">
            <column name="privilege" value="pharmacy:validate inventories"/>
            <column name="description" value="Savics pharmacy: Able to validate inventories"/>
            <column name="uuid" value="b93a0ddd-d21b-493e-98e8-4f1de0620d3b"/>
        </insert>
        
    </changeSet>
    
    <changeSet id="pharm-202131271413" author="anatoleabe">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from role where role like '%Pharmacy%';</sqlCheck>
        </preConditions>
        <insert tableName="role">
            <column name="role" value="Pharmacy: Manager"/>
            <column name="description" value="Savics pharmacy: the manager"/>
            <column name="uuid" value="b92a0ddd-d22b-493e-98e8-4d1de0621a8v"/>
        </insert>
        <insert tableName="role">
            <column name="role" value="Pharmacy: Administrator"/>
            <column name="description" value="Savics pharmacy: the Administrator"/>
            <column name="uuid" value="b92a0ddd-d22b-493e-98e8-4d1de0621a9v"/>
        </insert>
        <insert tableName="role">
            <column name="role" value="Approve Orders"/>
            <column name="description" value="Savics pharmacy: Approve Orders"/>
            <column name="uuid" value="b92a0ddd-d22b-493e-98e8-4d1de0623c1u"/>
        </insert>
    </changeSet>
    
    <changeSet id="pharm-202111231413" author="anatoleabe">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from role where role like '%Pharmacy: Distributor%';</sqlCheck>
        </preConditions>
        <insert tableName="role">
            <column name="role" value="Pharmacy: Distributor"/>
            <column name="description" value="Savics pharmacy: the distributor"/>
            <column name="uuid" value="b92a0ddd-d22b-493e-98e8-4d1de0621a7v"/>
        </insert>
    </changeSet>
    
    <changeSet author="anatoleabe" id="pharm-20211620641663079-14">
        <sql>
            ALTER TABLE pharm_item MODIFY code VARCHAR(120)
        </sql>
    </changeSet>
    
    <changeSet author="anatoleabe (generated)" id="1620641683809-54_1">
        <addForeignKeyConstraint baseColumnNames="item_line_id" baseTableName="pharm_sending_detail" constraintName="FKpharm_send540246_1" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_items_line" />
    </changeSet>
    
    <changeSet author="anatoleabe" id="1620641683809-55"> 
        <addColumn tableName="pharm_sending" >
            <column  name="visit_id" type="INT"/> 
        </addColumn>  
    </changeSet>
    
    <changeSet author="anatoleabe" id="1620641683809-56">
        <addForeignKeyConstraint baseColumnNames="visit_id" baseTableName="pharm_sending" constraintName="FKpharm_send223203" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="visit_id" referencedTableName="visit" />
    </changeSet>
    
    <changeSet  author="anatoleabe"  id="1620641683809-58">  
        <dropNotNullConstraint  columnDataType="int" columnName="visit_id" tableName="pharm_sending"/>  
    </changeSet>
    
    <changeSet author="anatoleabe" id="1820641683801-60"> 
        <addColumn tableName="pharm_item" >
            <column  name="drug_id" type="INT"/> 
        </addColumn>  
    </changeSet>
                
    <changeSet  author="anatoleabe"  id="1820641683801-61">  
        <dropNotNullConstraint  columnDataType="int" columnName="drug_id" tableName="pharm_item"/>  
    </changeSet>
    
    <changeSet author="anatoleabe" id="1720641683809-59">
        <createIndex indexName="FKpharm_item581237" tableName="pharm_item">
            <column name="drug_id"/>
        </createIndex>
    </changeSet>
    
    <changeSet author="anatoleabe" id="1720641683801-40">
        <addForeignKeyConstraint baseColumnNames="drug_id" baseTableName="pharm_item" constraintName="FKpharm_item581237" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="drug_id" referencedTableName="drug" />
    </changeSet>
    
    <changeSet author="anatoleabe" id="1720641683801-41">
        <createTable tableName="pharm_drug_item_order">
            <column autoIncrement="true" name="id" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="date" type="datetime"/>
            <column name="drug_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="visit_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column defaultValue="" name="uuid" type="VARCHAR(38)">
                <constraints nullable="false"/>
            </column>
            <column name="encounter_id" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="INT"/>
        </createTable>
        <createIndex indexName="FKpharm_drugitemorder581237" tableName="pharm_drug_item_order">
            <column name="drug_id"/>
        </createIndex>
        <addForeignKeyConstraint baseColumnNames="drug_id" baseTableName="pharm_drug_item_order" constraintName="FKpharm_drugitemorder581237" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="drug_id" referencedTableName="drug" />
        
        <createIndex indexName="FKpharm_drugitemorder581234" tableName="pharm_drug_item_order">
            <column name="visit_id"/>
        </createIndex>
        <addForeignKeyConstraint baseColumnNames="visit_id" baseTableName="pharm_drug_item_order" constraintName="FKpharm_drugitemorder581234" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="visit_id" referencedTableName="visit" />
        
        <createIndex indexName="FKpharm_drugitemorder581235" tableName="pharm_drug_item_order">
            <column name="encounter_id"/>
        </createIndex>
        <addForeignKeyConstraint baseColumnNames="encounter_id" baseTableName="pharm_drug_item_order" constraintName="FKpharm_drugitemorder581235" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="encounter_id" referencedTableName="encounter" />
    </changeSet>
    
    <changeSet author="anatoleabe" id="1720641683801-42">
        <addColumn tableName="pharm_drug_item_order" >
            <column  name="sending_id" type="INT"/> 
        </addColumn> 
        <createIndex indexName="FKpharm_drugitemorder591233" tableName="pharm_drug_item_order">
            <column name="sending_id"/>
        </createIndex>
        <addForeignKeyConstraint baseColumnNames="sending_id" baseTableName="pharm_drug_item_order" constraintName="FKpharm_drugitemorder591233" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="pharm_sending" />
    </changeSet>
</databaseChangeLog>

